<h4>{{isAdmin? 'Admin' : 'Member'}} Dashboard</h4>
<ngx-spinner></ngx-spinner>
<div class="card">

  <h5 class="card-header info-color white-text text-center py-4">
    <strong>Search Salon</strong>
  </h5>

  <!--Card content-->
  <div class="card-body px-lg-5">

    <!-- Form -->
    <form [formGroup]="searchForm" class="md-form" style="color: #757575;">
        <div class="d-flex flex-column">
            <input type="text" formControlName="salonName" class="form-control" id="salonName" placeholder="Enter Salon Name">
            <h5>OR</h5>
            <label class="position-relative" for="closingDate">Choose closing date</label>
            <input type="date" formControlName="closingDate" id="closingDate" class="form-control" mdbInput>
        </div>
        <div class="d-flex flex-row">
          <button class="btn btn-outline-info  btn-block z-depth-0 my-4 waves-effect"
          type="submit" (click)="searchSalon()">Search</button>
          <button *ngIf="isAdmin" class="btn btn-outline-info  ml-4 btn-block z-depth-0 my-4 waves-effect" (click)="createSalon()">Create Salon</button>
        </div>
    </form>
  </div>
  <table class="table table-striped table-responsive-md btn-table">

      <thead>
        <tr>
          <th>Salon Name</th>
          <th>Closing Date</th>
          <th>Status</th>
        </tr>
      </thead>
    
      <tbody>
        <tr *ngFor="let salon of searchResult; let i = index;">
          <th scope="row" (click)="salonDetails(salon.salonId)">{{salon.name}} 
            <i *ngIf="!isAdmin" class="fas fa-eye"></i> 
            <i *ngIf="isAdmin" class="fas fa-pencil-alt"></i>
          </th>
         
          <td>{{salon.closingDate}}</td>
          
          <td *ngIf="isAdmin">
            <button mdbBtn color="primary" outline="true" size="sm" mdbWavesEffect type="button" class="m-0" (click)="manageEvent(salon._id)">Manage</button>
          </td>
          <td *ngIf="!isAdmin && salon.state === 'RECDINV'">
            <button mdbBtn color="primary" outline="true" size="sm" mdbWavesEffect type="button" class="m-0" (click)="update(salon, 'INTERESTED')">Show Interest</button>
          </td>
          <td *ngIf="!isAdmin && salon.state === 'INTERESTED'">
              <i class="fas fa-check green-text"></i>
              <button mdbBtn color="primary" outline="true" size="sm" mdbWavesEffect type="button" class="m-0" data-toggle="modal" data-target="#modalPayment" (click)="setCurrent(salon)">Update Payment</button>
          </td>
          <td *ngIf="!isAdmin && salon.state === 'PAID'">
              <i class="far fa-money-bill-alt green-text"></i>

          </td>
          <td *ngIf="!isAdmin && salon.state === 'SHORTLISTED'">
              <i class="far fa-thumbs-up green-text"></i>
          </td>
          <td *ngIf="!isAdmin && salon.state === 'REJECTED'">
              <i class="far fa-thumbs-down red-text"></i>
          </td>
          <td *ngIf="salon.comments">
            <mdb-icon fas icon="comments" data-toggle="modal" data-target="#modalComments" (click)="loadComments(salon)"></mdb-icon>
          </td>
          <td *ngIf="!isAdmin && salon.state === 'COMPLETED'">
            <button mdbBtn color="primary" outline="true" size="sm" mdbWavesEffect type="button" class="m-0" data-toggle="modal" data-target="#modalResult" (click)="setCurrent(salon)">Update Results</button>
          </td>
          
        </tr>
       
      </tbody>
    </table>
      <div class="modal fade" id="modalPayment" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
          aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 font-weight-bold">Payment</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body mx-3">
            <div class="md-form mb-5">
              <i class="fas fa-money-bill-alt prefix grey-text"></i>
              <input id="defaultForm-email" [(ngModel)]="paymentId">
              <label data-error="wrong" data-success="right" for="defaultForm-email">Payment Id</label>
            </div>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button class="btn btn-default" (click)="updatePayment()">Update</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="modalResult" tabindex="0" role="dialog" aria-labelledby="myModalLabel1"
          aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 font-weight-bold">{{modalTitle}}</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div *ngIf="resultsToggle" class="results-page">
              <div class="row">
                <div class="col" mdbWavesEffect (click)="updateResult('WINNER')">
                    <i class="fas fa-trophy prefix red-text" ></i>
                    <input  id="winner" hidden>
                    <label class="p-3" data-error="wrong" data-success="right" for="winner">WINNER!</label>
                </div>
              </div>

              <div class="row">
                <div class="col" mdbWavesEffect (click)="updateResult('RUNNERUP')">
              
                  <mdb-icon id="runner-up" fas icon="award" ></mdb-icon>
                  <input  id="runner-up" hidden>
                  <label class="p-3" data-error="wrong" data-success="right" for="runner-up">2nd Prize</label>
                </div>
              </div>
            </div>
            <div *ngIf="commentsToggle" class="comments-page w-100">
                <mat-form-field>
                    <textarea matInput [(ngModel)]="comment" placeholder="Leave a feedback about the Salon"></textarea>
                </mat-form-field>
                <mat-raised-button (click)="postComment()">Post</mat-raised-button>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    <div class="modal fade" id="modalComments" tabindex="1" role="dialog" aria-labelledby="myModalLabel1"
          aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header text-center">
            <h4 class="modal-title w-100 font-weight-bold">Feedback/Comments</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row" *ngFor="let commentO of salonComments">
              <div class="col-md-2">
                <span class="small">{{commentO.user}}</span>
              </div>
              <div class="col-md-10">
                {{commentO.comment}}
              </div>
            </div>
            
          </div>
          
        </div>
      </div>
    </div>
    
    
</div>